import{T as f,g as x,d as L,a as M,c as D,e as k}from"./index.3c687da4.js";import{i as T}from"./echarts.0ee7ac4e.js";import{bF as u,by as l,bt as m,bs as _,bE as r,bU as p,bA as h}from"./vendor.78372706.js";import"./vant.cb96953f.js";const C="_chart_wrapper_wal8l_1",I={chart_wrapper:C},Y="_echart_fcigr_1",q={echart:Y},F={tooltip:{show:!0,trigger:"axis",formatter:([t])=>{const[s,e]=t.data;return`${new f(new Date(s)).format("YYYY\u5E74MM\u6708DD\u65E5")} \uFFE5${x(e)}`}},grid:[{left:5,right:5,top:20,bottom:20}],xAxis:{type:"time",boundaryGap:["5%","3%"],axisLabel:{formatter:t=>new f(new Date(t)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},V=u({props:{name:{type:String},data:{type:Array,required:!0}},setup(t,s){const e=l();let a;return m(()=>{!e.value||(a=T(e.value),a.setOption({...F,series:[{data:t.data,type:"line"}]}))}),_(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>r("div",{ref:e,class:q.echart},null)}}),E="_echart2_1t6eq_1",B={echart2:E},N={tooltip:{trigger:"item",formatter:t=>{const{name:s,value:e,percent:a}=t;return`${s}: \uFFE5${x(e)} \u5360\u6BD4 ${a}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},P=u({props:{name:{type:String},data:{type:Array}},setup(t,s){const e=l();let a;return m(()=>{!e.value||(a=T(e.value),a.setOption(N))}),_(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>r("div",{ref:e,class:B.echart2},null)}}),U="_echart3_8di9l_1",G="_topItem_8di9l_5",R="_sign_8di9l_11",W="_bar_wrapper_8di9l_22",X="_bar_text_8di9l_27",j="_bar_8di9l_22",z="_bar_inner_8di9l_41",o={echart3:U,topItem:G,sign:R,bar_wrapper:W,bar_text:X,bar:j,bar_inner:z},H=u({props:{data:{type:Array}},setup(t,s){return()=>r("div",{class:o.echart3},[t.data&&t.data.length>0?t.data.map(({tag:e,amount:a,percent:c})=>r("div",{class:o.topItem},[r("div",{class:o.sign},[e.sign]),r("div",{class:o.bar_wrapper},[r("div",{class:o.bar_text},[r("span",null,[e.name,p(" - "),c,p("%")]),r("span",null,[p("\uFFE5"),r(L,{value:a},null)])]),r("div",{class:o.bar},[r("div",{class:o.bar_inner,style:{width:`${c}%`}},null)])])])):r("div",null,[p("\u6CA1\u6709\u6570\u636E")])])}}),J=24*3600*1e3,K=u({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(t,s)=>{const e=l("expenses"),a=l([]),c=h(()=>{if(!t.startDate||!t.endDate)return[];const i=(new Date(t.endDate).getTime()-new Date(t.startDate).getTime())/J+1;return Array.from({length:i}).map((v,O)=>{const y=new f(t.startDate+"T00:00:00.000+0800").add(O,"day").getTimestamp(),w=a.value[0],$=w&&new Date(w.happen_at+"T00:00:00.000+0800").getTime()===y?a.value.shift().amount:0;return[new Date(y).toISOString(),$]})}),b=async()=>{const n=await D.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:e.value,group_by:"happen_at"},{_mock:"itemSummary",_autoLoading:!0});a.value=n.data.groups};m(b),_(()=>e.value,b);const d=l([]),S=h(()=>d.value.map(n=>({name:n.tag.name,value:n.amount}))),g=async()=>{const n=await D.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:e.value,group_by:"tag_id"},{_mock:"itemSummary",_autoLoading:!0});d.value=n.data.groups};m(g),_(()=>e.value,g);const A=h(()=>{const n=d.value.reduce((i,v)=>i+v.amount,0);return d.value.map(i=>({...i,percent:Math.round(i.amount/n*100)}))});return()=>r("div",{class:I.chart_wrapper},[r(M,{label:"\u7C7B\u578B",type:"select",options:[{value:"expenses",text:"\u652F\u51FA"},{value:"income",text:"\u6536\u5165"}],modelValue:e.value,"onUpdate:modelValue":n=>e.value=n},null),r(V,{data:c.value},null),r(P,{data:S.value},null),r(H,{data:A.value},null)])}}),at=u({setup(t,s){return()=>r(k,{reRenderOnSwitchTab:!0,component:K},null)}});export{at as StatisticsPage,at as default};
